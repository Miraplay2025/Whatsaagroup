<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>WhatsApp Session via Drive</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<style>
body { font-family: Arial; background: linear-gradient(135deg,#141e30,#243b55); color:#fff; padding:20px; }
.container { max-width:900px; margin:auto; }
.card { background:rgba(255,255,255,.08); padding:20px; border-radius:14px; margin-bottom:20px; }
input,button,textarea { width:100%; padding:14px; margin-top:10px; border:none; border-radius:10px; }
button { background:#25D366; font-weight:bold; cursor:pointer; }
button:disabled { background:#777; cursor:not-allowed; }
.logs { background:#000; color:#0f0; height:260px; overflow:auto; padding:10px; }
.group { border-bottom:1px solid rgba(255,255,255,.2); padding:8px 0; }
.hidden { display:none; }
</style>
</head>

<body>
<div class="container">
  <h1>ğŸ“¦ WhatsApp via Google Drive</h1>

  <div class="card">
    <input id="driveLink" placeholder="Cole o link do Google Drive">
    <button id="startBtn">ğŸš€ Iniciar Processo</button>
  </div>

  <div class="card">
    <h3>ğŸ“œ Logs</h3>
    <div id="logs" class="logs"></div>
  </div>

  <div class="card hidden" id="infoCard">
    <h3>ğŸ‘¤ Conta</h3>
    <p id="user"></p>
    <h3>ğŸ‘¥ Grupos</h3>
    <div id="groups"></div>
  </div>

  <div class="card hidden" id="sendCard">
    <h3>âœ‰ï¸ Enviar Mensagem</h3>
    <input type="text" id="msgNumber" placeholder="NÃºmero (ex: 5511999999999)">
    <textarea id="msgText" placeholder="Digite a mensagem..."></textarea>
    <button id="sendMsgBtn">ğŸ“¨ Enviar</button>
  </div>

</div>

<script>
const SERVER_URL = "https://whatsaagroup.onrender.com";
const socket = io(SERVER_URL,{transports:['websocket']});

const logs = document.getElementById('logs');
const startBtn = document.getElementById('startBtn');
const driveLink = document.getElementById('driveLink');
const infoCard = document.getElementById('infoCard');
const sendCard = document.getElementById('sendCard');
const userEl = document.getElementById('user');
const groupsEl = document.getElementById('groups');
const sendMsgBtn = document.getElementById('sendMsgBtn');
const msgNumber = document.getElementById('msgNumber');
const msgText = document.getElementById('msgText');

function addLog(msg){ const d=document.createElement('div'); d.textContent=msg; logs.appendChild(d); logs.scrollTop=logs.scrollHeight; }

socket.on('log', addLog);

socket.on('session-info', data=>{
  infoCard.classList.remove('hidden');
  sendCard.classList.remove('hidden');
  userEl.textContent = `${data.name} (${data.number})`;
  groupsEl.innerHTML='';
  if(!data.groups.length){ groupsEl.innerHTML='<p>Nenhum grupo encontrado</p>'; return; }
  data.groups.forEach(g=>{
    const d=document.createElement('div'); d.className='group';
    d.innerHTML=`<b>${g.name}</b> â€” ${g.members} membros`;
    groupsEl.appendChild(d);
  });
});

startBtn.onclick=()=>{
  const link=driveLink.value.trim();
  if(!link) return alert('Cole o link do Google Drive');
  addLog('â–¶ Processo iniciado...');
  socket.emit('start-from-drive', link);
};

sendMsgBtn.onclick=()=>{
  const number = msgNumber.value.trim();
  const message = msgText.value.trim();
  if(!number||!message){ alert('NÃºmero e mensagem obrigatÃ³rios'); return; }
  socket.emit('send-message', {number, message});
  addLog(`ğŸ“¨ Enviando mensagem para ${number}...`);
};
</script>

</body>
</html>
