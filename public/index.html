<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>WhatsApp Session Validator</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{
  margin:0;
  font-family:Segoe UI,Arial;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
}
.container{max-width:900px;margin:auto;padding:20px}
.card{
  background:rgba(255,255,255,.08);
  backdrop-filter:blur(10px);
  border-radius:14px;
  padding:20px;
  margin-bottom:20px;
}
button,input{
  width:100%;
  padding:14px;
  border-radius:8px;
  border:none;
  margin-top:10px;
}
button{background:#00c853;color:#fff;cursor:pointer}
.group{background:rgba(255,255,255,.1);padding:10px;border-radius:8px;margin-top:6px}
.logs{max-height:240px;overflow:auto;font-size:13px}

/* MODAL */
.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal-box{
  background:#1e293b;
  padding:20px;
  border-radius:14px;
  width:90%;
  max-width:400px;
}
</style>
</head>

<body>
<div class="container">

<div class="card">
  <h2>Validar Sess√£o WhatsApp</h2>
  <input type="file" id="zip" accept=".zip">
  <button onclick="validate()">üîç Validar WhatsApp</button>
</div>

<div class="card">
  <h3>Status da Conta</h3>
  <div id="account">‚Äî</div>
</div>

<div class="card">
  <h3>Grupos</h3>
  <div id="groups">‚Äî</div>
</div>

<div class="card">
  <button onclick="openModal()">üì© Enviar Mensagem</button>
</div>

<div class="card logs" id="logs"></div>

</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-box">
    <h3>Enviar Mensagem</h3>
    <input id="number" placeholder="N√∫mero com DDI">
    <input id="message" placeholder="Mensagem">
    <button onclick="send()">Enviar</button>
    <button onclick="closeModal()">Fechar</button>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const logs = document.getElementById('logs');

function log(m){
  const d=document.createElement('div');
  d.textContent=m;
  logs.appendChild(d);
  logs.scrollTop=logs.scrollHeight;
}
socket.on('log',log);

async function validate(){
  const f = zip.files[0];
  if(!f){
    log('‚ùå Selecione o arquivo ZIP da sess√£o');
    return;
  }

  log('üì§ Enviando ZIP para valida√ß√£o...');
  const fd = new FormData();
  fd.append('zip', f);

  const res = await fetch('/validate',{
    method:'POST',
    body:fd
  });

  if(!res.ok){
    log('‚ùå ZIP inv√°lido');
    return;
  }

  log('‚úÖ ZIP enviado. Verificando sess√£o no WhatsApp...');
  socket.emit('start-validation');
}

socket.on('account',d=>{
  account.innerHTML = `<b>${d.name}</b><br>${d.number}`;
});

socket.on('groups',g=>{
  groups.innerHTML='';
  g.forEach(x=>{
    groups.innerHTML+=
      `<div class="group">${x.name} ‚Äî ${x.total} membros</div>`;
  });
});

socket.on('no-groups',()=>{
  groups.textContent='Nenhum grupo encontrado';
});

function openModal(){ modal.style.display='flex'; }
function closeModal(){ modal.style.display='none'; }

function send(){
  socket.emit('send-message',{
    number:number.value,
    message:message.value
  });
}
</script>
</body>
</html>
